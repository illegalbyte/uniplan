{% extends 'app_uniplan/base.html' %}


{% block content %}

<h1>Your upcoming assignments</h1>

<a href="{% url "add_all_missing_assignments" %}"><button class="btn btn-warning">Click to add <b>{{total_assignments_count}} Tasks</b> Not yet added</button></a>


<table id="assignments" class="table table-striped table-bordered">
	<thead>
		<tr>
			<th>Edit</th>
			<th>Unit</th>
			<th>Assignment</th>
			<th>Due Week</th>
			<th>Due Week (#)</th>
			<th>Due Date</th>
			<th>Status</th>
		</tr>
	</thead>
	<tbody>
		{% for assignment in assignments %}
		<tr>
			<td><center><a href="{{ assignment.id }}"><i class="fa-solid fa-pen-to-square"></i></a></center></td>
			<td>{{ assignment.unit }}</td>
			<td><a href="{{ assignment.id }}">{{ assignment.title }}</a></td>
			<td>{{ assignment.due_week_text }}</td>
			<td class="editable" data-id="{{ assignment.id }}" data-type="due_week_number">{{ assignment.due_week_number }}</td>
			<td>{{ assignment.due_date }}</td>
			<td>{{ assignment.status }}</td>
		</tr>
		{% endfor %}
	</tbody>
</table>
<script>
{% comment %} var editor = new $.fn.dataTable.Editor( {
    ajax:  '/api/staff',
    table: '#assignments',
    fields: [
		{label : "Unit", name: "unit_code"},
		{label: "Title", name: "title"},
		{label: "Due Week", name: "due_week"},
		{label: "Due Date", name: "due_date"},
		{label: "Status", name: "status"},
    ]
} ); {% endcomment %}

$(document).ready(function() {
    $('#assignments').DataTable({
		"order": [[ 2, "des" ]],
		"paging": false,
		"info": false,
		{% comment %} 
		"ajax": "{% url 'assignments_json' %}",
		"columns": [
			{ "data": "unit_code" },
			{ "data": "title" },
			{ "data": "due_week_text" },
			{ "data": "due_date" },
			{ "data": "status" }
		],
		"select": true, 
		"buttons": [
			{ extend: 'create', editor: editor },
			{ extend: 'edit',   editor: editor },
			{ extend: 'remove', editor: editor }
		], {% endcomment %}
	});
});

$(document).ready(function() {
	$('.editable').editable(function(value, settings) {
		var id = $(this).data('id');
		var type = $(this).data('type');
		var data = {};
		data[type] = value;
		$.ajax({
			url: "/api/staff/" + id,
			type: "PUT",
			data: data,
			success: function(result) {
				console.log(result);
			}
		});
		return(value);
	}, {
		type: 'text',
		submit: 'OK',
		cancel: 'Cancel',
		indicator: 'Saving...',
		tooltip: 'Click to edit...'
	});
} );


</script>

<hr>
<details><summary>Add an assignment manually</summary>
<h1>Add an assignment</h1>
<form method="POST">
	{% csrf_token %}
	{{ form.as_p }}
	<button type="submit" class="btn btn-primary">Add</button>
</form>
<details>
{% endblock %}